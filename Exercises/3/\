import csv

COL_LEN = 10


class Stock:
    def __init__(self, name, shares, price) -> None:
        self.name = name
        self.shares = shares
        self.price = price

    def cost(self):
        return round(self.shares * self.price, 2)

    def sell(self, vol):
        if self.shares == 0:
            return "No shares to sell"
        elif vol > self.shares:
            sold = self.shares
            self.shares = 0
            return f"Sold all {sold} shares"
        else:
            self.shares -= vol
            return f"Sold {vol} shares"


def read_portfolio(filename):
    data = []
    with open(filename) as f:
        rows = csv.reader(f)
        next(rows)
        conv = [str, int, float]
        for r in rows:
            data.append(Stock(*[fn(v) for fn, v in zip(conv, r)]))
    return data


def preprocess_headers(func):
    def wrapper(p, headers=None):
        filtered_headers = headers if headers else vars(p[0]).keys()
        return func(filtered_headers)

    return wrapper


@preprocess_headers
def _print_headers(_, headers):
    print(" ".join(f"{h:>{COL_LEN}}" for h in headers))


@preprocess_headers
def _print_seps(_, headers):
    print(" ".join("-" * COL_LEN for _ in headers))


@preprocess_headers
def _print_portfolio(p, headers):
    for item in p:
        print(
            " ".join(
                f"{getattr(item,header):>{COL_LEN}}" for header in filtered_headers
            )
        )


def printer(fns, v, headers):
    for fn in fns:
        fn(v, headers)


def print_portfolio(p, headers=None):
    fns = [_print_headers, _print_seps, _print_portfolio]
    printer(fns, p, headers)
